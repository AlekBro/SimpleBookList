@using SimpleBookList.Models;
@model IEnumerable<BookViewModel>

@{
    ViewBag.Title = "Index";
}

<h1 id="booksTitle">SimpleBookList</h1>
<h2>Books List</h2>

<hr />

<div id="FormHeader"></div>
<form id="CreateEditBookForm" style="display:none;">
    @{Html.RenderPartial("_partialForm");}
</form>

<hr />

<p><button id="CreateNewBookButton">Add New Book</button></p>


<script>
    $(function () {
        $("#CreateNewBookButton").click(function () {
            $('#FormHeader').html('<h3>Add new Book</h3>');

            $("#CreateEditBookForm").show("fast");

        });
    });

    // For work cancel button
    $("#CancelButton").click(function () {
        $('#FormHeader').html('');
        $("#CreateEditBookForm").hide();

        $('#CreateEditBookForm')[0].reset();
        //$("#searchableMultiselect option:selected").removeAttr("selected");
        //$("#searchableMultiselect").multiselect("clearSelection");

        $('.searchableMultiselect').multiSelect('deselect_all');
    });

    function editFunc(obj, event) {
        event.preventDefault();
        event.stopPropagation();

        var value = obj.getAttribute('value');

        $.ajax({
            url: '/api/Authors',
            type: 'GET',
            dataType: 'json',
            success: function (result) {
                //WriteResponse(data);
                var authorsDropDown = $('#AuthorsIds');
                authorsDropDown.empty();
                $(result.data).each(function () {
                    $(document.createElement('option'))
                        .attr('value', this.Id)
                        .text(this.Name)
                        .appendTo(authorsDropDown);
                });

                SetMultiselect();
            },
            error: function (x, y, z) {
                alert(x + '\n' + y + '\n' + z);
            }
        });

        $('#FormHeader').html('<h3>Edit Book</h3>');

        $("#CreateEditBookForm").show("fast");



    };





    function deleteFunc(obj, event) {
        event.preventDefault();
        event.stopPropagation();

        var value = obj.getAttribute('value');

        getRequest("@Url.Action("Delete")", { Id: value });
    };

    function getRequest(urlString, dataString) {
        $.ajax({
            url: urlString,
            data: dataString,
            type: "GET",
            success: function (response) {
                $("#dialogContainer").html(response);
                window.scrollTo(0, 0);
            }
        });
    };

</script>

<table class="table" id="BooksListTable" cellspacing="0">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Id)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ReleaseDate)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Pages)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Rating)
            </th>
            <th>
                Authors
            </th>
            <th>
                Edit
            </th>
            <th>
                Delete
            </th>
        </tr>
    </thead>
    
</table>


